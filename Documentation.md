# Документация программного обеспечения моделирования ЗРК

## Основная логика работы системы

### 1. Инициализация временного шага
Система начинает новый цикл симуляции, в котором все объекты выполняют запрограммированные действия в строгой последовательности.

### 2. Обновление воздушной обстановки
- **Перемещение объектов**: Каждый летательный аппарат (самолеты, вертолеты, ракеты) перемещается по формуле:  
  `Новая позиция = Текущая позиция + (Вектор скорости × Временной шаг)`
- **Формирование списка**: Создается полный перечень всех объектов с указанием:
  - Координат (x, y, z)
  - Вектора скорости
  - Идентификатора
  - Типа объекта (цель/ракета)
- **Распределение данных**: Список передается всем активным радиолокационным станциям через систему сообщений.

### 3. Работа радиолокационных станций
- **Сканирование пространства**:  
  `Новый угол = Текущий угол + (Скорость вращения × Временной шаг)`  
  При достижении границ сектора - сброс или изменение угла.
- **Обнаружение целей**: Проверка:
  - Принадлежности к текущему сектору
  - Попадания в рабочий диапазон дальности
- **Передача данных**: На ПБУ отправляются:
  - Точные координаты
  - Вектор скорости
  - Идентификатор
  - Время обнаружения

### 4. Работа пункта боевого управления (ПБУ)
- **Анализ целей**:
  - Идентификация (новая/известная)
  - Расчет траектории
  - Оценка угрозы
- **Управление перехватом**:
  - Для известных целей: коррекция траектории ракет
  - Для новых целей: запрос ракет и запуск

### 5. Пусковые установки
- **Обработка запросов**: Проверка наличия ракет
- **Процедура запуска**:
  - Подготовка ракеты
  - Передача параметров цели
  - Фиксация запуска
- **Уведомление системы** о новом объекте

### 6. Поведение ракет
- **Наведение**: Коррекция траектории на каждом шаге
- **Перехват**: Движение по расчетной траектории
- **Завершение**:
  - Подрыв при достижении цели
  - Уведомление системы

### 7. Фиксация результатов
- Сохранение:
  - Позиций объектов
  - Переданных сообщений
  - Ключевых событий
- Подготовка к новому циклу

### 8. Интерфейс пользователя
- **Визуализация**:
  - Позиции объектов
  - Состояние радаров
  - Статус ракет
- **Управление**:
  - Пауза/продолжение
  - Настройка параметров
  - Запрос информации

# Модуль радиолокатора

**Ответственный**: Олег Ремизов (тимлид)

## Назначение
Радиолокатор предназначен для сканирования воздушного пространства и обнаружения объектов в зоне своего обзора. Основные параметры:
- Угол раскрыва по азимуту
- Угловая скорость сканирования
- Начальное положение

## Принцип работы
Сектор обзора радара поворачивается на угол, рассчитываемый как произведение скорости вращения на пройденное время. При обнаружении объектов передает их параметры на ПБУ через систему сообщений.

## Математическая модель

### Определение координат объектов
1. **Расстояние до объекта**:  
   `d = √[(xₜ-xᵣ)² + (yₜ-yᵣ)² + (zₜ-zᵣ)²]`  
   Где (xᵣ,yᵣ,zᵣ) - координаты радара, (xₜ,yₜ,zₜ) - координаты цели.

2. **Азимутальный угол**:  
   `φ = arctan[(yₜ-yᵣ)/(xₜ-xᵣ)] × 180/π mod 360°`

3. **Угол места**:  
   `θ = arcsin[(zₜ-zᵣ)/d] × 180/π mod 180°`

### Условия обнаружения
Объект считается обнаруженным при выполнении:
1. `d ≤ d_max` (не превышена максимальная дальность)
2. `φ₀ ≤ φ ≤ φ₀+Δφ` (попадание в сектор по азимуту)
3. `θ₀ ≤ θ ≤ θ₀+Δθ` (попадание в сектор по углу места)

## Алгоритмы сканирования

### Горизонтальное сканирование
1. Изменение азимута: `φₙ₊₁ = φₙ + v_φ × Δt`
2. При достижении границы сектора:
   - Сброс азимута: `φₙ₊₁ = φ₀`
   - Изменение угла места: `θₘ₊₁ = θₘ + v_θ × Δt`
3. Полный охват сектора → сброс угла места: `θₘ₊₁ = θ₀`

### Вертикальное сканирование
1. Изменение угла места: `θₘ₊₁ = θₘ + v_θ × Δt`
2. При достижении границы:
   - Сброс угла места: `θₘ₊₁ = θ₀`
   - Изменение азимута: `φₙ₊₁ = φₙ + v_φ × Δt`
3. Полный охват → сброс азимута: `φₙ₊₁ = φ₀`

### Круговое сканирование
1. Непрерывное изменение азимута: `φₙ₊₁ = (φₙ + v_φ × Δt) mod 360°`
2. После полного оборота: дискретное изменение угла места

## Управление параметрами
Возможна оперативная настройка:
- Ширины секторов (Δφ, Δθ)
- Скоростей сканирования (v_φ, v_θ)

## Особенности работы
- Последовательное секторное сканирование
- Циклический характер обзора
- Гибкая настройка параметров
- Интеграция с системой управления

## Методы модуля
- **find_visible_objects()**: Поиск объектов в текущем секторе обзора
- **move_to_next_sector()**: Переход к следующему сектору сканирования
- **update_scan_parameters()**: Изменение параметров сканирования
- **start()**: Запуск симуляции работы радара

# Модуль пункта боевого управления (ПБУ)

## Основные функции
1. **Управление целями и ракетами**
- Хранение информации о целях (TargetCCP) и ракетах (MissileCCP) в словарях
- Добавление/удаление целей и ракет
- Обновление информации о целях и ракетах

2. **Координация с другими элементами системы**
- Запрос количества доступных ракет у пусковых установок (ПУ)
- Получение информации о запущенных ракетах
- Получение сообщений о поражении целей или самоуничтожении ракет

3. **Алгоритм связывания объектов (link_object)**
- Определяет, является ли обнаруженный объект:
  * Новой целью (NEW_TARGET)
  * Уже отслеживаемой целью (OLD_TARGET)
  * Запущенной ракетой (OLD_ROCKET)
- Использует расчет возможного диапазона перемещения объекта за время между обновлениями

4. **Логика запуска ракет (try_to_launch_missile)**
- Поиск ближайшей ПУ с доступными ракетами
- Отправка команды на запуск ракеты
- Обновление счетчика запущенных ракет

5. **Обработка различных типов объектов**
- Для новых целей: попытка запуска ракеты и добавление в список отслеживаемых
- Для известных целей: обновление координат и перенацеливание ракет
- Для ракет: обновление информации о положении

6. **Визуализация**
- Отправка данных о целях и ракетах для отображения в GUI

Ключевые особенности:
- Использование временных меток для корректного связывания объектов
- Учет возможной погрешности при определении положения объектов
- Координация работы между ПБУ, радарами и пусковыми установками
- Логгирование всех значимых событий


# Модуль пользовательского интерфейса (UI)

**Ответственный**: Ермошин Максим

## Функциональность
- Чтение данных моделирования из файлов (JSON и др.)
- Визуализация данных:
  - Отображение на карте
  - Табличное представление
- Настройка отображения:
  - Выбор слоев
  - Масштабирование
  - Фильтрация объектов

# Модуль воздушной обстановки (ВО)

**Ответственный**: Андрей Дойников

## Основные функции
- Получение данных о целях от UI
- Обновление координат всех воздушных объектов
- Передача актуальных данных радиолокаторам

## Методы
```python
def add_targets(self, targets: List[Target]) -> None:
    """Добавление новых целей в систему"""
    
def step(self) -> None:
    """Обновление состояния воздушной обстановки"""
```

# Модуль пусковых установок (ПУ)

**Ответственный**: Шафран Богдан

## Функциональность
- Учет боезапаса (количество доступных ЗУР)
- Процедура запуска ракет
- Передача информации о запусках в ПБУ

## Методы
```python
def add_missile(self, missile: Missile) -> bool:
    """Добавление ракеты в арсенал"""
    
def count_missiles(self) -> int:
    """Получение количества доступных ракет"""
    
def launch_missile(self) -> None:
    """Процедура запуска ЗУР"""
    
def step(self) -> None:
    """Цикл работы пусковой установки"""
    
def send_message(self, msg) -> None:
    """Отправка сообщений в систему"""
    
def get_messages(self) -> List:
    """Получение входящих сообщений"""
```

# Модуль зенитной управляемой ракеты (ЗУР)

**Ответственный**: Фёдоров Всеволод

## Основная функциональность
- Прием команд управления от пусковой установки
- Расчет оптимальной траектории перехвата
- Исполнение полетного задания
- Подрыв при достижении цели или по истечении времени

## Алгоритм работы

### Жизненный цикл ЗУР
1. **Инициализация**: Создание объекта в пусковой установке
2. **Подготовка**: 
   - Установка боевого положения (`set()`)
   - Расчет начальной траектории
   - Ожидание команды запуска
3. **Запуск**: 
   - Активация по команде (`_launch()`)
   - Старт таймера полета
4. **Полет**:
   - Коррекция траектории
   - Отправка телеметрии
   - Контроль сближения с целью
5. **Завершение**:
   - Подрыв при поражении цели
   - Самоликвидация по таймеру
   - Уведомление системы

### Расчет траектории перехвата
1. Получение параметров цели:
   - Позиция: (x_target, y_target, z_target)
   - Скорость: (vx_target, vy_target, vz_target)

2. Вычисление вектора смещения:
   `D = (x_target - x_ракеты, y_target - y_ракеты, z_target - z_ракеты)`

3. Решение уравнения:
   ```
   A * Δt² + B * Δt + C = 0
   Где:
   A = (vx_target² + vy_target² + vz_target²) - V_ракеты²
   B = 2*(vx_target*Dx + vy_target*Dy + vz_target*Dz)
   C = Dx² + Dy² + Dz²
   ```

4. Определение вектора скорости:
   ```
   V_ракеты = (
       vx_target + Dx/Δt,
       vy_target + Dy/Δt,
       vz_target + Dz/Δt
   )
   ```

5. Нормализация скорости до заданного модуля

## Класс Trajectory
```python
class Trajectory:
    """
    Модель движения ракеты в пространстве
    S = S0 + V * t
    где:
    - S0 - начальная позиция
    - V - вектор скорости
    - t - время полета
    """
    
    def __init__(self, velocity=(0,0,0), start_pos=(0,0,0)):
        self.velocity = velocity  # Вектор скорости (vx,vy,vz)
        self.start_pos = start_pos  # Начальная позиция
        self.start_time = 0  # Время старта
    
    def get_pos(self, t: float) -> tuple:
        """Вычисление позиции в момент времени t"""
        return (
            self.start_pos[0] + self.velocity[0]*(t-self.start_time),
            self.start_pos[1] + self.velocity[1]*(t-self.start_time),
            self.start_pos[2] + self.velocity[2]*(t-self.start_time)
        )
```

## Класс Missile
```python
class Missile:
    """Модель зенитной управляемой ракеты"""
    
    def __init__(self, velocity_module=1000, pos=(0,0,0), 
                 detonate_radius=1, detonate_period=50):
        self.velocity_module = velocity_module  # Модуль скорости
        self.detonate_radius = detonate_radius  # Радиус поражения
        self.detonate_period = detonate_period  # Время самоликвидации
        self.trajectory = None  # Объект траектории
        self.launch_time = 0  # Время запуска
        self.status = 'wait'  # Статус: wait/ready/active/detonated
    
    def set(self, target: Target):
        """Подготовка к запуску"""
        self.status = 'ready'
        # Расчет начальной траектории
    
    def _launch(self, target_pos: tuple):
        """Процедура запуска"""
        self.status = 'active'
        self.launch_time = current_time()
    
    def _set_trajectory(self, new_trajectory):
        """Обновление траектории"""
        self.trajectory = new_trajectory
    
    def _detonate(self):
        """Процедура подрыва"""
        self.status = 'detonated'
        # Отправка сообщений о подрыве
    
    def step(self):
        """Основной цикл работы"""
        if self.status == 'ready':
            # Ожидание команды запуска
            pass
        elif self.status == 'active':
            # Обновление позиции
            current_pos = self.trajectory.get_pos(current_time())
            # Проверка условий подрыва
            if distance_to_target < self.detonate_radius:
                self._detonate()
            # Контроль времени полета
            if current_time() - self.launch_time > self.detonate_period:
                self._detonate()
```

## Модель сообщений
Базовый класс:
```python
class BaseMessage:
    """
    Базовое сообщение системы
    :param relevance: приоритет обработки
    :param send_time: время отправки
    :param type: тип сообщения
    :param sender_ID: идентификатор отправителя
    :param receiver_ID: идентификатор получателя
    """
```
Вот структурированная таблица с запрошенными данными:

| Название                     | Тип (type)               | Описание                                                                 | Когда отправляется                                                                 | Содержимое                                                                 |
|------------------------------|--------------------------|--------------------------------------------------------------------------|-----------------------------------------------------------------------------------|----------------------------------------------------------------------------|
| MissileCountRequestMessage    | -                        | ПБУ запрашивает у ПУ количество ЗУР                                      | В начале шага симуляции                                                           | -                                                                          |
| MissileCountResponseMessage   | -                        | ПУ сообщает ПБУ количество доступных ЗУР                                 | После получения запроса от ПБУ                                                   | missile_number (количество ракет)                                         |
| -                            | -                        | ПБУ получил сообщение об уничтожении ЗУР                                 | В начале шага симуляции                                                           | missile_id (идентификатор ракеты)                                         |
| -                            | -                        | ПБУ получил сообщение от МФР с обнаруженными объектами                   | В начале шага симуляции                                                           | visible_objects (список видимых объектов)                                 |
| CPPLaunchMissileRequestMessage| -                        | ПБУ отправляет команду на запуск ЗУР по новой цели                       | При обнаружении новой цели                                                        | curr_target_id, target_coord, MFR_id (ID цели, координаты, ID МФР)        |
| LaunchedMissileMessage        | -                        | ПУ уведомляет ПБУ о запуске ЗУР                                         | После получения команды от ПБУ                                                   | missile_id, order (ID ракеты, порядковый номер)                           |
| -                            | -                        | ПБУ сообщает МФР о новых координатах цели для ЗУР                        | При обнаружении сопровождаемой ЗУР                                               | target, missile_id (цель, ID ракеты)                                      |
| -                            | -                        | ПБУ отправляет данные для визуализации                                   | -                                                                                 | coordinates_list (список координат)                                       |
| UpdateTargetPosition          | -                        | Радар передает ЗУР обновленные координаты цели                           | После получения данных от ПБУ                                                    | upd_object (обновленные данные цели)                                      |
| FoundObjectsMessage           | -                        | Радар сообщает ПБУ о обнаруженных объектах                               | После обработки данных от ВО                                                     | visible_objects (список видимых объектов)                                 |
| DestroyedMissileId            | -                        | Радар уведомляет ПБУ о подорванной ракете                                | После получения сообщения от ракеты                                              | missile_id (ID ракеты)                                                    |
| ActiveObjectsMessage          | -                        | ВО передает радару данные о всех активных объектах                       | После обновления позиций                                                         | active_objects (список активных объектов)                                 |
| MissileDetonateMessage        | MISSILE_DETONATE         | ЗУР уведомляет о своем подрыве                                           | В момент уничтожения (поражение цели или истечение времени)                      | missile_id (ID ракеты)                                                    |
| MissilePosMessage             | MISSILE_POS              | ЗУР передает свои текущие координаты                                     | Каждый тик при активном статусе                                                  | missile_id (ID ракеты)                                                    |
